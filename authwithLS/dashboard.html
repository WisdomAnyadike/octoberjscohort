<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1> welcome <span id="usersName"> loading.... </span></h1> <button onclick="logOut()"> logout </button>


    <div>
        <div> <input type="text" id="title" placeholder="enter title here"> </div>

        <div> <input type="text" id="description" placeholder="enter description here"> </div>

        <input type="file" id="picture" accept=".jpg,.mp4,.jpeg,.mov" onchange="pickPicture()">
        <div> <img id="blogImg" width="50px" height="50px" alt=""> </div>

        <button onclick="postBlog()"> post </button>
    </div>


    <div id="preview">


    </div>

</body>

</html>
<script>

    let users = JSON.parse(localStorage.getItem('databaseOctober')) || [] //  let users = [obj , obj , obj , obj , obj]
    let currentUserIndex = localStorage.getItem('loggedInUserIndex') // 4
    let currentUser = users[currentUserIndex]


    function checkUserAuth() {
        if (!currentUser) {
            alert('unauthorized')
            location.href = 'login.html'
        }
    }

    checkUserAuth()

    function displayName(params) {
        usersName.innerHTML = currentUser.username
    }

    displayName()


    function logOut() {
        let confirmLogout = window.confirm('are you sure you want to logout?')
        if (confirmLogout) {
            localStorage.removeItem('loggedInUserIndex')
            location.href = 'login.html'
        }
    }

    let blogDatabase = currentUser.blogs || []



    // let arr = ['wisdom', 'tolu', 'daniel']
    // let nameIndex = 2
    // arr[nameIndex]


    function postBlog(params) {
        if (!title.value.trim() || !description.value.trim() || !blogImg.src) {
            alert('all fields are mandatory')
        } else if (blogDatabase.find((blogObj, i) => { return blogObj.title === title.value.trim() })) {
            alert('blog title already exists')
        } else {
            let blog = {
                title: title.value.trim(),
                description: description.value.trim(),
                image: blogImg.src,
                isLiked: false
            }

            blogDatabase.push(blog)
            localStorage.setItem('databaseOctober', JSON.stringify(users))
            displayBlogs()




        }

    }


    displayBlogs()

    function displayBlogs(params) {


        preview.innerHTML = ''

        if (blogDatabase.length === 0) {
            preview.innerHTML = 'no blogs yet....'

        } else {
            blogDatabase.forEach((blog, i) => {
                // function pickWhetherLikedOrUnliked() {
                //     if (blog.isLiked) {
                //         return 'UNLIKE'
                //     } else {
                //         return 'LIKE'
                //     }
                // }

                preview.innerHTML += `
                <p> ${blog.title} </p> 
                <p> ${blog.description} </p>
                <img width="200" height="200" src="${blog.image}"/>
                <button onclick="helpLike( ${i})" > ${blog.isLiked ? "UNLIKE" : 'LIKE'} </button>
                 <button onclick="deleteBlog(${i})" > delete </button>
                `
            });
        }



    }


    function helpLike(index) {
        // if (isBlogLiked) {
        //     currentUser.blogs[index].isLiked = false
        // } else {
        //     currentUser.blogs[index].isLiked = true
        // }

        currentUser.blogs[index].isLiked = !currentUser.blogs[index].isLiked
        localStorage.setItem('databaseOctober', JSON.stringify(users))
        displayBlogs()
        console.log(currentUser, isBlogLiked);



    }

    function deleteBlog(index) {
        let canDelete = confirm('are you sure you want to delete')

        if (canDelete) {
            currentUser.blogs.splice(index, 1)
            localStorage.setItem('databaseOctober', JSON.stringify(users))
            displayBlogs()
        }

    }




    function pickPicture() {
        let file = document.getElementById('picture').files[0]

        if (!file) {
            alert('please attach a file')
            return
        }

        if (file.size / 1024 > 400) {
            alert('file too large , make sure its less than 400kb')
            return
        }

        const reader = new FileReader();
        reader.readAsDataURL(file)

        reader.addEventListener('load', (e) => {
            console.log(e);

            let result = e.target.result
            blogImg.src = result
            console.log(result);

        })












    }



    let obj = {
        name: 'dave',
        isliked: true
    }


    obj.isliked = !obj.isliked


    let arr = [1, 24, 465]

    arr.find((num) => { return num === 24 })

    arr.splice(1, 1)



</script>